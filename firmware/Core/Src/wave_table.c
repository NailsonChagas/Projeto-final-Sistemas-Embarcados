/*
 * wave_table.c
 *
 *  Created on: Dec 1, 2025
 *      Author: nailsonchagas
 */
#include "wave_table.h"

static const float square_wave[N_POINTS] = {
    0.500000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 1.000000f, 1.000000f, 1.000000f, 1.000000f,
    1.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
    0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
    0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
    0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
    0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
    0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
    0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
    0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
    0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f,
    0.000000f, 0.000000f, 0.000000f, 0.000000f, 0.000000f
};

static const float sine_wave[N_POINTS] = {
    0.500000f, 0.531395f, 0.562667f, 0.593691f, 0.624345f,
    0.654508f, 0.684062f, 0.712890f, 0.740877f, 0.767913f,
    0.793893f, 0.818712f, 0.842274f, 0.864484f, 0.885257f,
    0.904508f, 0.922164f, 0.938153f, 0.952414f, 0.964888f,
    0.975528f, 0.984292f, 0.991144f, 0.996057f, 0.999013f,
    1.000000f, 0.999013f, 0.996057f, 0.991144f, 0.984292f,
    0.975528f, 0.964888f, 0.952414f, 0.938153f, 0.922164f,
    0.904508f, 0.885257f, 0.864484f, 0.842274f, 0.818712f,
    0.793893f, 0.767913f, 0.740877f, 0.712890f, 0.684062f,
    0.654508f, 0.624345f, 0.593691f, 0.562667f, 0.531395f,
    0.500000f, 0.468605f, 0.437333f, 0.406309f, 0.375655f,
    0.345492f, 0.315938f, 0.287110f, 0.259123f, 0.232087f,
    0.206107f, 0.181288f, 0.157726f, 0.135516f, 0.114743f,
    0.095492f, 0.077836f, 0.061847f, 0.047586f, 0.035112f,
    0.024472f, 0.015708f, 0.008856f, 0.003943f, 0.000987f,
    0.000000f, 0.000987f, 0.003943f, 0.008856f, 0.015708f,
    0.024472f, 0.035112f, 0.047586f, 0.061847f, 0.077836f,
    0.095492f, 0.114743f, 0.135516f, 0.157726f, 0.181288f,
    0.206107f, 0.232087f, 0.259123f, 0.287110f, 0.315938f,
    0.345492f, 0.375655f, 0.406309f, 0.437333f, 0.468605f
};

static const float rectified_sine_wave[N_POINTS] = {
    0.500000f, 0.531395f, 0.562667f, 0.593691f, 0.624345f,
    0.654508f, 0.684062f, 0.712890f, 0.740877f, 0.767913f,
    0.793893f, 0.818712f, 0.842274f, 0.864484f, 0.885257f,
    0.904508f, 0.922164f, 0.938153f, 0.952414f, 0.964888f,
    0.975528f, 0.984292f, 0.991144f, 0.996057f, 0.999013f,
    1.000000f, 0.999013f, 0.996057f, 0.991144f, 0.984292f,
    0.975528f, 0.964888f, 0.952414f, 0.938153f, 0.922164f,
    0.904508f, 0.885257f, 0.864484f, 0.842274f, 0.818712f,
    0.793893f, 0.767913f, 0.740877f, 0.712890f, 0.684062f,
    0.654508f, 0.624345f, 0.593691f, 0.562667f, 0.531395f,
    0.500000f, 0.531395f, 0.562667f, 0.593691f, 0.624345f,
    0.654508f, 0.684062f, 0.712890f, 0.740877f, 0.767913f,
    0.793893f, 0.818712f, 0.842274f, 0.864484f, 0.885257f,
    0.904508f, 0.922164f, 0.938153f, 0.952414f, 0.964888f,
    0.975528f, 0.984292f, 0.991144f, 0.996057f, 0.999013f,
    1.000000f, 0.999013f, 0.996057f, 0.991144f, 0.984292f,
    0.975528f, 0.964888f, 0.952414f, 0.938153f, 0.922164f,
    0.904508f, 0.885257f, 0.864484f, 0.842274f, 0.818712f,
    0.793893f, 0.767913f, 0.740877f, 0.712890f, 0.684062f,
    0.654508f, 0.624345f, 0.593691f, 0.562667f, 0.531395f
};


static const float triangle_wave[N_POINTS] = {
    0.500000f, 0.520000f, 0.540000f, 0.560000f, 0.580000f,
    0.600000f, 0.620000f, 0.640000f, 0.660000f, 0.680000f,
    0.700000f, 0.720000f, 0.740000f, 0.760000f, 0.780000f,
    0.800000f, 0.820000f, 0.840000f, 0.860000f, 0.880000f,
    0.900000f, 0.920000f, 0.940000f, 0.960000f, 0.980000f,
    1.000000f, 0.980000f, 0.960000f, 0.940000f, 0.920000f,
    0.900000f, 0.880000f, 0.860000f, 0.840000f, 0.820000f,
    0.800000f, 0.780000f, 0.760000f, 0.740000f, 0.720000f,
    0.700000f, 0.680000f, 0.660000f, 0.640000f, 0.620000f,
    0.600000f, 0.580000f, 0.560000f, 0.540000f, 0.520000f,
    0.500000f, 0.480000f, 0.460000f, 0.440000f, 0.420000f,
    0.400000f, 0.380000f, 0.360000f, 0.340000f, 0.320000f,
    0.300000f, 0.280000f, 0.260000f, 0.240000f, 0.220000f,
    0.200000f, 0.180000f, 0.160000f, 0.140000f, 0.120000f,
    0.100000f, 0.080000f, 0.060000f, 0.040000f, 0.020000f,
    0.000000f, 0.020000f, 0.040000f, 0.060000f, 0.080000f,
    0.100000f, 0.120000f, 0.140000f, 0.160000f, 0.180000f,
    0.200000f, 0.220000f, 0.240000f, 0.260000f, 0.280000f,
    0.300000f, 0.320000f, 0.340000f, 0.360000f, 0.380000f,
    0.400000f, 0.420000f, 0.440000f, 0.460000f, 0.480000f
};

static const float *waveforms[] = {
    square_wave,
    sine_wave,
    rectified_sine_wave,
    triangle_wave
};

void waveform_init(WaveformCtrl *ctrl)
{
	ctrl->type = WAVE_SQUARE;
	ctrl->index = 0;
}

void waveform_get_sample(WaveformCtrl *ctrl, float *out)
{
	// desabilitar interrupção do botão aqui
	*out = waveforms[ctrl->type][ctrl->index];
	ctrl->index++;
	if (ctrl->index >= N_POINTS) {
		ctrl->index = 0;
	}
	// habilitar interrupção do botão aqui
}

void waveform_next_wave(WaveformCtrl *ctrl)
{
    ctrl->type++;

    if (ctrl->type >= WAVE_MAX) {
        ctrl->type = WAVE_SQUARE;
    }

    ctrl->index = 0;
}


